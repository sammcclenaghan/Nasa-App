<%= turbo_stream_from :weather_results %>

<div class="mx-auto max-w-7xl py-10">
  <header class="space-y-2 text-center mb-8">
    <h1 class="text-3xl font-bold">NASA Space Apps Weather Dashboard</h1>
    <p class="text-gray-600">Submit a location and date to forecast extreme weather probabilities powered by the Python modeling module.</p>
  </header>

  <!-- Two-column layout: Map + Form -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Left Column - Map Section -->
    <div class="space-y-4">
      <div class="relative bg-gray-200 rounded-lg overflow-hidden" style="height: 500px;">
        <div id="map"
             data-controller="map"
             data-map-latitude-value="37.7751"
             data-map-longitude-value="-122.4202"
             data-map-zoom-value="10"
             class="w-full h-full">
        </div>

        <!-- Location display at bottom of map -->
        <div class="absolute bottom-4 left-4 bg-white bg-opacity-90 px-3 py-2 rounded shadow">
          <div class="text-sm font-medium">Location (37.7751, -122.4202)</div>
          <div class="text-xs text-gray-600">37.7751, -122.4202</div>
        </div>
      </div>
    </div>

    <!-- Right Column - Form Section -->
    <div class="bg-white">
      <header class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Location & Date</h1>
        <p class="text-gray-600 mt-2">Select your location and date to analyze weather patterns</p>
      </header>

      <%= form_with model: WeatherResult.new, url: weather_results_path, class: "space-y-6" do |form| %>
        <!-- Location Input -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
          <div class="relative">
            <input type="text"
                   placeholder="Enter city or address..."
                   class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-4">
              <svg class="w-5 h-5 text-white bg-blue-600 rounded p-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <p class="text-sm text-gray-500 mt-1">Or click on the map to select a location</p>
        </div>

        <!-- Hidden coordinate fields that will be populated by map -->
        <div class="hidden">
          <%= form.number_field :lat, step: 0.000001, class: "w-full" %>
          <%= form.number_field :lon, step: 0.000001, class: "w-full" %>
        </div>

        <!-- Event Date -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Event Date</label>
          <div class="relative">
            <%= date_field_tag 'weather_result[query_date]',
                               Date.current.to_s,
                               class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Conditions Analyzed Section -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <h3 class="text-sm font-medium text-gray-900 mb-3">Conditions Analyzed</h3>
          <div class="space-y-2 text-sm">
            <div class="flex items-center space-x-2">
              <span class="w-3 h-3 bg-red-500 rounded-full flex-shrink-0"></span>
              <span class="text-gray-700">Very Hot (>90°F)</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="w-3 h-3 bg-blue-500 rounded-full flex-shrink-0"></span>
              <span class="text-gray-700">Very Cold (<32°F)</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="w-3 h-3 bg-gray-400 rounded-full flex-shrink-0"></span>
              <span class="text-gray-700">Very Windy (>25 mph)</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="w-3 h-3 bg-blue-600 rounded-full flex-shrink-0"></span>
              <span class="text-gray-700">Very Wet (>0.5 in/day)</span>
            </div>
            <div class="flex items-center space-x-2">
              <span class="w-3 h-3 bg-yellow-500 rounded-full flex-shrink-0"></span>
              <span class="text-gray-700">Uncomfortable (Heat Index >80)</span>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div>
          <%= form.submit "Analyze Weather Patterns",
                          class: "w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 ease-in-out transform hover:scale-105" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-6 rounded-md bg-blue-50 border border-blue-100 p-4 text-sm text-blue-800">
    <p><strong>Privacy:</strong> Your weather analyses are stored anonymously with a private browser token. Clearing cookies or switching browsers/devices will reset your saved results. No account or personal data is stored.</p>
  </div>
  <section>
    <h2 class="mb-4 text-xl font-semibold">Recent results</h2>
    <div id="weather_results" class="space-y-4">
      <% if @weather_results.any? %>
        <%= render @weather_results %>
      <% else %>
        <p class="text-gray-500">No analyses yet. Submit your first query above.</p>
      <% end %>
    </div>
  </section>
</div>
